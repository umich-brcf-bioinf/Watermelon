# Example - Alternative references

Some projects may require alternative references. This example outlines a couple of cases of using alternative reference files.

## Background info:

Watermelon_init uses a [file - genome_references.yaml](config/genome_references.yaml), where each genome build entry contains pointers to the following files for each build:

* fasta - a [FASTA formatted](https://zhanglab.ccmb.med.umich.edu/FASTA/) file of the genomic DNA sequence
* gtf - a [GTF formatted](https://ensembl.org/info/website/upload/gff.html) file annotating the features (e.g. genes or transcripts).
* annotation_tsv - a tab-separated value file relating unique IDs from the GTF, to gene symbols, entrezgene IDs, and descriptions.
* rsem_star_index - a collection of files used by rsem-star for an index. The prefix is given here - several files will reside in this location, the prefix is how the index is referred to.

With the user's selection of a genome build, watermelon_init inserts the selected genome build information into the configuration file that is generated for the project.

Using alternative references is largely a matter of altering the above reference files in the generated config, and in some cases generating an appropriate annotation_tsv file.

## Details on using alternative references

The following organisms have ENSEMBL references already set up in the default `/nfs/turbo/umms-brcfpipeline/references` location:

Human, mouse, rat, zebrafish, C. elegans, and D. melanogaster

These entries all have a pre-generated rsem_star_index, which will be used by default. If you want to create a new index for these organisms (e.g. to insert exogenous genes as needed), delete the `rsem_star_index` entry from your config file and point the `fasta`, `gtf`, and `annotation_tsv` entries to your modified versions. The rsem-star index will be generated when the pipeline runs, before alignment can proceed. Note that it's best practice to keep these modified references somewhere in the project folder.

If a different organism is desired, then you'll have to acquire/create the appropriate reference files `fasta`, `gtf`, and `annotation_tsv`. The fasta and GTF can usually be downloaded (e.g. [from ENSEMBL](https://ensembl.org/info/data/ftp/index.html)), but the annotation_tsv will likely have to be generated by you. [Here's an example](doc/generating_annotation_tsv.md) using BiomaRt to generate the annotation_tsv table.

With the fasta, GTF, and annotation_tsv in place, the needed rsem-star index will be created when the pipeline runs, before alignment.

For simplicity when using non-standard organisms, there is a convenience genome build option `Other` when calling watermelon_init. This contains fake paths that of course must be replaced (e.g. `/path/to/genome.fasta`), but it also generates a config without fastq_screen parameters, thereby skipping that portion of the pipeline (since it would not work with a non-listed organism).

Example of using genome build `Other`:

    #Run watermelon_init (Note use of genome_build 'Other')
    watermelon_init.py --genome_build Other --project_id 20190824 --type align_qc --input_run_dirs /path/to/Run_2250

    # Modify the references in the generated config so that they point to the paths of the acquired/generated reference files
    nano config_20190824.yaml

    #Run the pipeline as you normally would
    # Singularity must be available to snakemake, for environment management under the hood
    module load singularity
    snakemake --configfile config_20190824.yaml --snakefile Watermelon/align_qc.smk --profile Watermelon/config/profile-greatlakes
